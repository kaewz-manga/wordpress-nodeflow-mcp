name = "wordpress-nodeflow-mcp"
main = "src/index.ts"
compatibility_date = "2024-11-27"
compatibility_flags = ["nodejs_compat"]

# =============================================================================
# D1 Database (SQLite) - For customers, API keys, subscriptions, usage
# =============================================================================
# Create with: wrangler d1 create wordpress-mcp-db
[[d1_databases]]
binding = "DB"
database_name = "wordpress-mcp-db"
database_id = "local-dev-db"  # Replace with actual ID after `wrangler d1 create`

# =============================================================================
# KV Namespace - For rate limiting and caching
# =============================================================================
# Create with: wrangler kv:namespace create "RATE_LIMIT"
[[kv_namespaces]]
binding = "RATE_LIMIT_KV"
id = "local-dev-kv"  # Replace with actual ID after `wrangler kv:namespace create`

# =============================================================================
# Environment Variables
# =============================================================================
[vars]
ALLOWED_ORIGINS = "*"
ENVIRONMENT = "development"

# =============================================================================
# Production Environment
# =============================================================================
[env.production]
name = "wordpress-nodeflow-mcp"
route = { pattern = "wordpress-mcp.nodeflow.workers.dev", zone_name = "nodeflow.workers.dev" }

[[env.production.d1_databases]]
binding = "DB"
database_name = "wordpress-mcp-db"
database_id = "your-production-db-id"  # Replace after `wrangler d1 create`

[[env.production.kv_namespaces]]
binding = "RATE_LIMIT_KV"
id = "your-production-kv-id"  # Replace after `wrangler kv:namespace create`

# =============================================================================
# Development Environment
# =============================================================================
[env.development]
name = "wordpress-nodeflow-mcp-dev"

# =============================================================================
# Secrets (set via `wrangler secret put <KEY>`)
# =============================================================================
# WordPress Credentials (optional, for single-tenant mode):
# WORDPRESS_URL - Default WordPress site URL
# WORDPRESS_USERNAME - WordPress admin username
# WORDPRESS_APP_PASSWORD - WordPress Application Password (spaces removed)
# IMGBB_API_KEY - ImgBB API key for image uploads
#
# OAuth Credentials (required for OAuth login):
# GOOGLE_CLIENT_ID - Google OAuth client ID (from Google Cloud Console)
# GOOGLE_CLIENT_SECRET - Google OAuth client secret
# GITHUB_CLIENT_ID - GitHub OAuth app client ID (from GitHub Developer Settings)
# GITHUB_CLIENT_SECRET - GitHub OAuth app client secret
#
# Setup OAuth:
# 1. Google: https://console.cloud.google.com/apis/credentials
#    - Create OAuth 2.0 Client ID (Web application)
#    - Add redirect URI: https://your-worker.workers.dev/api/auth/callback/google
# 2. GitHub: https://github.com/settings/developers
#    - Create OAuth App
#    - Set callback URL: https://your-worker.workers.dev/api/auth/callback/github
#
# Stripe Billing (required for paid subscriptions):
# STRIPE_SECRET_KEY - Stripe secret key (sk_live_xxx or sk_test_xxx)
# STRIPE_WEBHOOK_SECRET - Stripe webhook signing secret (whsec_xxx)
# STRIPE_PUBLISHABLE_KEY - Stripe publishable key (pk_live_xxx or pk_test_xxx)
#
# Setup Stripe:
# 1. Create account: https://dashboard.stripe.com/register
# 2. Get API keys: https://dashboard.stripe.com/apikeys
# 3. Create products and prices for each tier:
#    - Starter: $9.99/month
#    - Pro: $29.99/month
#    - Enterprise: $99.99/month
# 4. Create webhook endpoint: https://dashboard.stripe.com/webhooks
#    - URL: https://your-worker.workers.dev/webhooks/stripe
#    - Events to listen:
#      - checkout.session.completed
#      - customer.subscription.created
#      - customer.subscription.updated
#      - customer.subscription.deleted
#      - invoice.paid
#      - invoice.payment_failed
# 5. Set STRIPE_PRICE_STARTER, STRIPE_PRICE_PRO, STRIPE_PRICE_ENTERPRISE secrets
#
# Commands to set secrets:
# wrangler secret put STRIPE_SECRET_KEY
# wrangler secret put STRIPE_WEBHOOK_SECRET
# wrangler secret put STRIPE_PUBLISHABLE_KEY
